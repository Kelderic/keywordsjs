!function(e){e.Keywords=function(){var t=function(t){var o=this;if("selector"in t)var n=document.querySelector(t.selector);else if("el"in t)n=t.el;if(!n)return!1;o.dragging=!1;var a=document.querySelector("style#kwjs-css");a?o.css=a:(o.css=document.createElement("style"),o.css.type="text/css",o.css.id="kwjs-css",o.css.innerHTML=`\n\t\t\t\t\t.kwjs-outerwrap { position: relative; }\n\t\t\t\t\t.kwjs-keywordwrap { pointer-events: none; position: absolute; z-index:1; padding: 4px 0 4px 4px; }\n\t\t\t\t\t.kwjs-keyword { display: inline-block; font-size: inherit; font-weight: inherit; font-style: inherit; font-family: inherit; vertical-align:bottom; pointer-events: auto; position: relative; border-radius: 2px; box-sizing: border-box; margin-right: 4px; cursor: move }\n\t\t\t\t\t.kwjs-choiceswrap { position: absolute; top: 100%; left: 0; right: 0; z-index:2; max-height:300px; overflow:auto; list-style: none; margin:0; padding:0; transform: scaleY(0); transform-origin:top; transition:transform 0.2s }\n\t\t\t\t\t.kwjs-choiceswrap li { cursor:pointer; padding:5px }\n\t\t\t\t\t.kwjs-choiceswrap li:hover, li.kwjs-highlighted { background:${n.parentElement.getVisibleBackgroundColor()}; }\n\t\t\t\t\tli.kwjs-alreadychosen, li.kwjs-filteredout { display:none; }\n\t\t\t\t\t.kwjs-focused .kwjs-choiceswrap { transform:none; }\n\t\t\t\t`,document.body.appendChild(o.css)),o.el={},o.el.input=n,o.el.fake=o.el.input.cloneNode(),o.el.fake.name="",o.el.fake.id="",o.el.fake.value="";var h=e.getComputedStyle(o.el.input,null),d=h.getPropertyValue("display");o.el.input.type="hidden",o.colors={},"colors"in t&&(o.colors.default="default"in t.colors?t.colors.default:{},o.colors.highlight="highlight"in t.colors?t.colors.highlight:{},"color"in o.colors.default&&(o.colors.default.fill=o.colors.default.color),"color"in o.colors.highlight&&(o.colors.highlight.fill=o.colors.highlight.color)),"delimiter"in t?o.delimiter=t.delimiter:null!==o.el.input.getAttribute("kwjs-delimiter")?o.delimiter=o.el.input.getAttribute("kwjs-delimiter"):o.delimiter=" ";var s="";if("choices"in t)var c=t.choices;else if(null!==o.el.input.getAttribute("kwjs-choices"))s=o.el.input.getAttribute("kwjs-choices"),c=o.el.input.getAttribute("kwjs-choices").split(o.delimiter).filter(function(e){return 0!=e.length});else c=[];if(c.length>0){s='<li class="kwjs-filteredout" style="color:gray;font-style:italic;pointer-events:none">Unallowed</li>';for(var g=0,u=c.length;g<u;g++)s+="<li>"+c[g]+"</li>";o.restrict=!0}else o.restrict=!1;o.el.outerWrap=document.createElement("div"),o.el.keywordWrap=document.createElement("div"),o.el.template=document.createElement("div"),o.el.template.draggable=!0,o.el.dropzone=document.createElement("div"),o.el.choicesWrap=document.createElement("ul"),o.el.choicesWrap.innerHTML=s,o.el.choicesWrap.tabIndex=-1,o.el.unallowed=o.el.choicesWrap.firstElementChild,o.el.highlightedKeyword=null,o.el.highlightedChoice=null,o.el.beingDragged=null,o.el.outerWrap.className="kwjs-outerwrap",o.el.keywordWrap.className="kwjs-keywordwrap",o.el.template.className="kwjs-keyword",o.el.choicesWrap.className="kwjs-choiceswrap",o.el.dropzone.className="kwjs-keyword kwjs-dropzone",i(o.el.outerWrap,{display:"inline"==d?"inline-block":d,width:h.getPropertyValue("width"),"min-width":h.getPropertyValue("min-width"),"max-width":h.getPropertyValue("max-width")}),i(o.el.keywordWrap,{top:h.getPropertyValue("border-top-width"),left:h.getPropertyValue("border-left-width")}),i(o.el.template,{"padding-left":parseInt(h.getPropertyValue("padding-left"))-2+"px","padding-right":parseInt(h.getPropertyValue("padding-right"))-2+20+"px","line-height":parseInt(h.getPropertyValue("height"))-8+"px",height:parseInt(h.getPropertyValue("height"))-8+"px"}),i(o.el.choicesWrap,{background:h.getPropertyValue("background"),"background-color":h.getPropertyValue("background-color"),"box-shadow":"0px 0px 2px 1px rgba(0, 0, 0, 0.3)"}),i(o.el.template,o.colors.default),i(o.el.dropzone,{"padding-left":"2px","padding-right":"2px",height:parseInt(h.getPropertyValue("height"))-8+"px",background:"rgb(30,130,230)",margin:"0 0 0 -4px"}),i(o.el.dropzone,o.colors.highlight),o.el.input.parentNode.insertBefore(o.el.outerWrap,o.el.input.nextSibling),o.el.outerWrap.appendChild(o.el.input),o.el.outerWrap.appendChild(o.el.fake),o.el.outerWrap.appendChild(o.el.keywordWrap),c.length>0&&o.el.outerWrap.appendChild(o.el.choicesWrap),o.updateKeywordsFromRealString(o.el.input.value),o.el.choicesWrap.addEventListener("mousedown",function(t){0===t.button?("li"==t.target.nodeName.toLowerCase()&&o.addKeyword({keyword:t.target.textContent,match:"exact"}),e.setTimeout(function(e){o.el.fake.focus()},10)):t.preventDefault()}),o.el.outerWrap.addEventListener("focusin",function(e){o.el.outerWrap.classList.add("kwjs-focused"),o.el.highlightedKeyword&&o.unhighlightKeyword(o.el.highlightedKeyword)}),o.el.outerWrap.addEventListener("focusout",function(t){e.setTimeout(function(e){o.el.outerWrap.contains(document.activeElement)||o.el.outerWrap.classList.remove("kwjs-focused")},20),o.el.fake.value&&e.setTimeout(function(e){o.addKeyword({keyword:o.el.fake.value,match:"begins-with"})},10)}),o.el.outerWrap.addEventListener("keypress",function(t){1!==t.key.length||t.ctrlKey||(t.key==o.delimiter?(t.preventDefault(),o.el.fake.value?e.setTimeout(function(e){o.addKeyword({keyword:o.el.fake.value,match:"begins-with"})},10):o.el.highlightedChoice&&(t.preventDefault(),o.addKeyword({keyword:o.el.highlightedChoice.textContent,match:"exact"}))):o.updateFilteredChoicesFromInput(o.el.fake.value+t.key))}),o.el.outerWrap.addEventListener("keydown",function(t){var i=null;if(13==t.which)o.el.fake.value&&(t.preventDefault(),e.setTimeout(function(e){o.addKeyword({keyword:o.el.fake.value,match:"begins-with"})},10)),o.el.highlightedChoice&&(t.preventDefault(),o.addKeyword({keyword:o.el.highlightedChoice.textContent,match:"exact"}));else if(8==t.which)!o.el.fake.value&&o.el.keywordWrap.children.length>0?(t.preventDefault(),o.el.highlightedKeyword?((i=o.el.highlightedKeyword).previousElementSibling?o.highlightKeyword(i.previousElementSibling):o.el.fake.focus(),o.removeKeyword(i)):o.highlightKeyword(o.el.keywordWrap.lastChild)):e.setTimeout(function(e){o.updateFilteredChoicesFromInput(o.el.fake.value)},10);else if(46==t.which)!o.el.fake.value&&o.el.keywordWrap.children.length>0?o.el.highlightedKeyword&&((i=o.el.highlightedKeyword).nextElementSibling?o.highlightKeyword(i.nextElementSibling):o.el.fake.focus(),o.removeKeyword(i)):e.setTimeout(function(e){o.updateFilteredChoicesFromInput(o.el.fake.value)},10);else if(37==t.which)!o.el.fake.value&&o.el.keywordWrap.children.length>0&&(o.el.highlightedKeyword?(i=o.el.highlightedKeyword).previousElementSibling&&(o.unhighlightKeyword(i),o.highlightKeyword(i.previousElementSibling)):o.highlightKeyword(o.el.keywordWrap.lastChild));else if(39==t.which)!o.el.fake.value&&o.el.keywordWrap.children.length>0&&o.el.highlightedKeyword&&(i=o.el.highlightedKeyword,o.unhighlightKeyword(i),i.nextElementSibling?o.highlightKeyword(i.nextElementSibling):o.el.fake.focus());else if(38==t.which||40==t.which){t.preventDefault();var l,n=o.el.choicesWrap.querySelectorAll(":not(.kwjs-alreadychosen):not(.kwjs-filteredout)");o.el.highlightedKeyword||(o.el.highlightedChoice?(l=r(n,o.el.highlightedChoice),(l=38==t.which?l-1:l+1)<0?o.highlightChoice(null):l<n.length&&o.highlightChoice(n[l])):o.highlightChoice(38==t.which?null:n[0]))}}),o.el.outerWrap.addEventListener("paste",function(t){e.setTimeout(function(e){o.updateFilteredChoicesFromInput(o.el.fake.value)},10)}),o.el.keywordWrap.addEventListener("click",function(e){"button"==e.target.nodeName.toLowerCase()&&(o.removeKeyword(e.target.parentNode),o.el.fake.focus())}),o.el.keywordWrap.addEventListener("dragstart",function(e){var t=l(e.target);t&&(e.dataTransfer.setData("text/html",t),o.el.beingDragged=t,o.dragging=!0,o.el.highlightedKeyword&&o.unhighlightKeyword(o.el.highlightedKeyword))}),document.addEventListener("dragover",function(e){if(e.preventDefault(),o.dragging){var t=l(e.target);if(t&&!t.classList.contains("kwjs-dropzone")){var i=t.getBoundingClientRect(),r=i.x+i.width/2;e.clientX-r>0?o.el.keywordWrap.insertBefore(o.el.dropzone,t.nextElementSibling):o.el.keywordWrap.insertBefore(o.el.dropzone,t)}}}),document.addEventListener("drop",function(e){e.preventDefault(),o.dragging&&(o.dragging=!1,o.el.keywordWrap.insertBefore(o.el.beingDragged,o.el.dropzone),o.el.keywordWrap.removeChild(o.el.dropzone),o.el.input.value=o.buildRealStringFromKeywords())}),document.addEventListener("dragover",function(e){o.dragging&&e.preventDefault()})};function i(e,t){for(var i in t)t.hasOwnProperty(i)&&(e.style[i]=t[i])}function r(e,t){for(var i=0,r=e.length;i<r;i++)if(t==e[i])return i;return-1}function l(e){if("kwjs-keyword"==e.className)return e;for(;"kwjs-keyword"!=e.className&&"body"!=e.nodeName.toLowerCase();)e=e.parentNode;return"body"!=e.tagName.toLowerCase()&&e}return t.prototype.addKeyword=function(e){var t="keyword"in e?e.keyword:"",i="match"in e?e.match:"exact";if(""!==t)if(this.restrict&&"begins-with"==i&&(t=this.autoCompleteKeyword(t)),""===t)this.el.fake.value="",this.updateFilteredChoicesFromInput(this.el.fake.value);else{var r=this.el.template.cloneNode();r.innerHTML=t+'<button type="button" tabindex="-1" style="appearance:none; fill:inherit; color:inherit; font-size:0; background:transparent; border:none; box-shadow:none; cursor:pointer; position:absolute; top:calc(50% - 10px); right:2px; padding:4px; height:auto; width:auto;"><svg style="pointer-events:none;height:14px;width:14px;" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 16 16"><polygon points="15,3 13,1 8,6 3,1 1,3 6,8 1,13 3,15 8,10 13,15 15,13 10,8 "/></svg></button>',this.el.keywordWrap.appendChild(r),this.el.fake.style["padding-left"]=this.el.keywordWrap.offsetWidth+6+"px",this.el.input.value=this.buildRealStringFromKeywords(),this.el.fake.value="",this.restrict&&(this.updateAlreadyChosenChoicesFromKeywords(),this.updateFilteredChoicesFromInput(this.el.fake.value))}},t.prototype.removeKeyword=function(e){this.el.keywordWrap.removeChild(e),this.el.fake.style["padding-left"]=this.el.keywordWrap.offsetWidth+6+"px",this.el.input.value=this.buildRealStringFromKeywords(),this.restrict&&this.updateAlreadyChosenChoicesFromKeywords()},t.prototype.highlightKeyword=function(e){i(e,this.colors.highlight),this.el.fake.blur(),e.firstElementChild.focus(),this.el.highlightedKeyword=e},t.prototype.unhighlightKeyword=function(e){i(e,this.colors.default),this.el.highlightedKeyword=null},t.prototype.buildRealStringFromKeywords=function(){for(var e="",t=this.el.keywordWrap.children,i=0,r=t.length;i<r;i++)e+=t[i].textContent+this.delimiter;return e},t.prototype.updateKeywordsFromRealString=function(e){if(this.el.keywordWrap.innerHTML="",e.trim())for(var t=e.trim().split(this.delimiter),i=0,r=t.length;i<r;i++)this.addKeyword({keyword:t[i],match:"exact"})},t.prototype.updateAlreadyChosenChoicesFromKeywords=function(){for(var e=this.el.choicesWrap.children,t=1,i=e.length;t<i;t++)this.el.input.value.indexOf(e[t].textContent)>-1?e[t].classList.add("kwjs-alreadychosen"):e[t].classList.remove("kwjs-alreadychosen")},t.prototype.updateFilteredChoicesFromInput=function(e){if(this.restrict){for(var t,i,r=!1,l=1,o=(t=this.el.choicesWrap.querySelectorAll(":not(.kwjs-alreadychosen)")).length;l<o;l++)i=t[l].textContent.toLowerCase(),e=e.toLowerCase(),0===i.indexOf(e)?(t[l].classList.remove("kwjs-filteredout"),r=!0):t[l].classList.add("kwjs-filteredout");this.el.highlightedChoice&&(this.el.highlightedChoice.classList.remove("kwjs-highlighted"),this.el.highlightedChoice=null),r?this.el.unallowed.classList.add("kwjs-filteredout"):this.el.unallowed.classList.remove("kwjs-filteredout")}},t.prototype.autoCompleteKeyword=function(e){var t;return!this.restrict||((t=this.el.choicesWrap.querySelectorAll(":not(:first-child):not(.kwjs-alreadychosen):not(.kwjs-filteredout)")).length>0?t[this.el.highlightedChoice?r(t,this.el.highlightedChoice):0].textContent:"")},t.prototype.highlightChoice=function(e){this.el.highlightedChoice&&this.el.highlightedChoice.classList.remove("kwjs-highlighted"),e&&e.classList.add("kwjs-highlighted"),this.el.highlightedChoice=e},HTMLElement.prototype.getVisibleBackgroundColor=function(){for(var t=this,i="";""==i||"rgba(0, 0, 0, 0)"==i||"transparent"==i;){if(i=r(t),"html"===t.tagName.toLowerCase()){i="white";break}t=t.parentNode}return i;function r(t){var i=e.getComputedStyle(t,null),r="";return""===r&&(r=t.style["background-color"]),""===r&&(r=t.style.background),""===r&&(r=i.getPropertyValue("background-color")),""===r&&(r=i.getPropertyValue("background")),r}},t}()}(window);