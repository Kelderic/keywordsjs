!function(e){e.Keywords=function(){function t(e,t){for(var i in t)t.hasOwnProperty(i)&&(e.style[i]=t[i])}function i(e,t){for(var i=0,o=e.length;i<o;i++)if(t==e[i])return i;return-1}function o(e){if("kwjs-keyword"==e.className)return e;for(;"kwjs-keyword"!=e.className&&"body"!=e.nodeName.toLowerCase();)e=e.parentNode;return"body"!=e.tagName.toLowerCase()&&e}var r=function(r){var l=this;if(!("selector"in r))return!1;l.colors={},"colors"in r&&(l.colors.default="default"in r.colors?r.colors.default:{},l.colors.highlight="highlight"in r.colors?r.colors.highlight:{},"color"in l.colors.default&&(l.colors.default.fill=l.colors.default.color),"color"in l.colors.highlight&&(l.colors.highlight.fill=l.colors.highlight.color)),l.delimiter="delimiter"in r?r.delimiter:" ",l.dragging=!1,l.restrict=!1;for(var n=("choices"in r?r.choices:[]),a='<li class="kwjs-filteredout" style="color:gray;font-style:italic;pointer-events:none">Unallowed</li>',h=0,d=n.length;h<d;h++)a+="<li>"+n[h]+"</li>",l.restrict=!0;l.css=document.createElement("style"),l.css.type="text/css",l.css.innerHTML+=".kwjs-outerwrap { position: relative; } ",l.css.innerHTML+=".kwjs-keywordwrap { pointer-events: none; position: absolute; z-index:1; padding: 4px 0 4px 4px; } ",l.css.innerHTML+=".kwjs-keyword { display: inline-block; font-size: inherit; font-weight: inherit; font-style: inherit; font-family: inherit; vertical-align:bottom; pointer-events: auto; position: relative; border-radius: 2px; box-sizing: border-box; margin-right: 4px; cursor: move } ",l.css.innerHTML+=".kwjs-choiceswrap { position: absolute; top: calc(100% + 2px); left: 0; right: 0; z-index:2; max-height:300px; overflow:auto; list-style: none; margin:0; padding:0; transform: scaleY(0); transform-origin:top; transition:transform 0.2s } ",l.css.innerHTML+=".kwjs-choiceswrap li { cursor:pointer; padding:5px } ",l.css.innerHTML+=".kwjs-choiceswrap li:hover, li.kwjs-highlighted { background:white; } ",l.css.innerHTML+="li.kwjs-alreadychosen, li.kwjs-filteredout { display:none; } ",l.css.innerHTML+=".kwjs-focused .kwjs-choiceswrap { transform:none; } ",document.body.appendChild(l.css),l.el={},l.el.input=document.querySelector(r.selector),l.el.fake=l.el.input.cloneNode(),l.el.fake.name="",l.el.fake.id="",l.el.fake.value="";var s=e.getComputedStyle(l.el.input,null),c=s.getPropertyValue("display");l.el.input.type="hidden",l.el.outerWrap=document.createElement("div"),l.el.keywordWrap=document.createElement("div"),l.el.template=document.createElement("div"),l.el.template.draggable=!0,l.el.dropzone=document.createElement("div"),l.el.choicesWrap=document.createElement("ul"),l.el.choicesWrap.innerHTML=a,l.el.choicesWrap.tabIndex=-1,l.el.unallowed=l.el.choicesWrap.firstElementChild,l.el.highlightedKeyword=null,l.el.highlightedChoice=null,l.el.beingDragged=null,l.el.outerWrap.className="kwjs-outerwrap",l.el.keywordWrap.className="kwjs-keywordwrap",l.el.template.className="kwjs-keyword",l.el.choicesWrap.className="kwjs-choiceswrap",l.el.dropzone.className="kwjs-keyword kwjs-dropzone",t(l.el.outerWrap,{display:"inline"==c?"inline-block":c,width:s.getPropertyValue("width")}),t(l.el.keywordWrap,{top:s.getPropertyValue("border-top-width"),left:s.getPropertyValue("border-left-width")}),t(l.el.template,{"padding-left":parseInt(s.getPropertyValue("padding-left"))-2+"px","padding-right":parseInt(s.getPropertyValue("padding-right"))-2+20+"px","line-height":parseInt(s.getPropertyValue("height"))-8+"px",height:parseInt(s.getPropertyValue("height"))-8+"px"}),t(l.el.choicesWrap,{background:s.getPropertyValue("background"),"background-color":s.getPropertyValue("background-color"),"box-shadow":s.getPropertyValue("box-shadow")}),t(l.el.template,l.colors.default),t(l.el.dropzone,{"padding-left":"2px","padding-right":"2px",height:parseInt(s.getPropertyValue("height"))-8+"px",background:"rgb(30,130,230)",margin:"0 0 0 -4px"}),t(l.el.dropzone,l.colors.highlight),l.el.input.parentNode.insertBefore(l.el.outerWrap,l.el.input.nextSibling),l.el.outerWrap.appendChild(l.el.input),l.el.outerWrap.appendChild(l.el.fake),l.el.outerWrap.appendChild(l.el.keywordWrap),n.length>0&&l.el.outerWrap.appendChild(l.el.choicesWrap),l.updateKeywordsFromRealString(l.el.input.value),l.el.choicesWrap.addEventListener("mousedown",function(t){1===t.buttons?("li"==t.target.nodeName.toLowerCase()&&l.addKeyword({keyword:t.target.textContent,match:"exact"}),e.setTimeout(function(e){l.el.fake.focus()},10)):t.preventDefault()}),l.el.outerWrap.addEventListener("focusin",function(e){l.el.outerWrap.classList.add("kwjs-focused"),l.el.highlightedKeyword&&l.unhighlightKeyword(l.el.highlightedKeyword)}),l.el.outerWrap.addEventListener("focusout",function(t){e.setTimeout(function(e){l.el.outerWrap.contains(document.activeElement)||l.el.outerWrap.classList.remove("kwjs-focused")},20),l.el.fake.value&&e.setTimeout(function(e){l.addKeyword({keyword:l.el.fake.value,match:"begins-with"})},10)}),l.el.outerWrap.addEventListener("keypress",function(t){1!==t.key.length||t.ctrlKey||(t.key==l.delimiter?(t.preventDefault(),l.el.fake.value?e.setTimeout(function(e){l.addKeyword({keyword:l.el.fake.value,match:"begins-with"})},10):l.el.highlightedChoice&&(t.preventDefault(),l.addKeyword({keyword:l.el.highlightedChoice.textContent,match:"exact"}))):l.updateFilteredChoicesFromInput(l.el.fake.value+t.key))}),l.el.outerWrap.addEventListener("keydown",function(t){var o=null;if(13==t.which)l.el.fake.value&&(t.preventDefault(),e.setTimeout(function(e){l.addKeyword({keyword:l.el.fake.value,match:"begins-with"})},10)),l.el.highlightedChoice&&(t.preventDefault(),l.addKeyword({keyword:l.el.highlightedChoice.textContent,match:"exact"}));else if(8==t.which)!l.el.fake.value&&l.el.keywordWrap.children.length>0?(t.preventDefault(),l.el.highlightedKeyword?((o=l.el.highlightedKeyword).previousElementSibling?l.highlightKeyword(o.previousElementSibling):l.el.fake.focus(),l.removeKeyword(o)):l.highlightKeyword(l.el.keywordWrap.lastChild)):e.setTimeout(function(e){l.updateFilteredChoicesFromInput(l.el.fake.value)},10);else if(46==t.which)!l.el.fake.value&&l.el.keywordWrap.children.length>0?l.el.highlightedKeyword&&((o=l.el.highlightedKeyword).nextElementSibling?l.highlightKeyword(o.nextElementSibling):l.el.fake.focus(),l.removeKeyword(o)):e.setTimeout(function(e){l.updateFilteredChoicesFromInput(l.el.fake.value)},10);else if(37==t.which)!l.el.fake.value&&l.el.keywordWrap.children.length>0&&(l.el.highlightedKeyword?(o=l.el.highlightedKeyword).previousElementSibling&&(l.unhighlightKeyword(o),l.highlightKeyword(o.previousElementSibling)):l.highlightKeyword(l.el.keywordWrap.lastChild));else if(39==t.which)!l.el.fake.value&&l.el.keywordWrap.children.length>0&&l.el.highlightedKeyword&&(o=l.el.highlightedKeyword,l.unhighlightKeyword(o),o.nextElementSibling?l.highlightKeyword(o.nextElementSibling):l.el.fake.focus());else if(38==t.which||40==t.which){t.preventDefault();var r,n=l.el.choicesWrap.querySelectorAll(":not(.kwjs-alreadychosen):not(.kwjs-filteredout)");l.el.highlightedKeyword||(l.el.highlightedChoice?(r=i(n,l.el.highlightedChoice),(r=38==t.which?r-1:r+1)<0?l.highlightChoice(null):r<n.length&&l.highlightChoice(n[r])):l.highlightChoice(38==t.which?null:n[0]))}}),l.el.outerWrap.addEventListener("paste",function(t){e.setTimeout(function(e){l.updateFilteredChoicesFromInput(l.el.fake.value)},10)}),l.el.keywordWrap.addEventListener("click",function(e){"button"==e.target.nodeName.toLowerCase()&&(l.removeKeyword(e.target.parentNode),l.el.fake.focus())}),l.el.keywordWrap.addEventListener("dragstart",function(e){var t=o(e.target);t&&(e.dataTransfer.setData("text/html",t),l.el.beingDragged=t,l.dragging=!0,l.el.highlightedKeyword&&l.unhighlightKeyword(l.el.highlightedKeyword))}),document.addEventListener("dragover",function(e){if(e.preventDefault(),l.dragging){var t=o(e.target);if(t&&!t.classList.contains("kwjs-dropzone")){var i=t.getBoundingClientRect(),r=i.x+i.width/2;e.clientX-r>0?l.el.keywordWrap.insertBefore(l.el.dropzone,t.nextElementSibling):l.el.keywordWrap.insertBefore(l.el.dropzone,t)}}}),document.addEventListener("drop",function(e){e.preventDefault(),l.dragging&&(l.dragging=!1,l.el.keywordWrap.insertBefore(l.el.beingDragged,l.el.dropzone),l.el.keywordWrap.removeChild(l.el.dropzone),l.el.input.value=l.buildRealStringFromKeywords())}),document.addEventListener("dragover",function(e){l.dragging&&e.preventDefault()})};return r.prototype.addKeyword=function(e){var t=this,i="keyword"in e?e.keyword:"",o="match"in e?e.match:"exact";if(""!==i)if(t.restrict&&"begins-with"==o&&(i=t.autoCompleteKeyword(i)),""===i)t.el.fake.value="",t.updateFilteredChoicesFromInput(t.el.fake.value);else{var r=t.el.template.cloneNode();r.innerHTML=i+'<button type="button" tabindex="-1" style="appearance:none; fill:inherit; color:inherit; font-size:0; background:transparent; border:none; box-shadow:none; cursor:pointer; position:absolute; top:calc(50% - 10px); right:2px; padding:4px; height:auto; width:auto;"><svg style="pointer-events:none;height:14px;width:14px;" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 16 16"><polygon points="15,3 13,1 8,6 3,1 1,3 6,8 1,13 3,15 8,10 13,15 15,13 10,8 "/></svg></button>',t.el.keywordWrap.appendChild(r),t.el.fake.style["padding-left"]=t.el.keywordWrap.offsetWidth+6+"px",t.el.input.value=t.buildRealStringFromKeywords(),t.el.fake.value="",t.restrict&&(t.updateAlreadyChosenChoicesFromKeywords(),t.updateFilteredChoicesFromInput(t.el.fake.value))}},r.prototype.removeKeyword=function(e){this.el.keywordWrap.removeChild(e),this.el.fake.style["padding-left"]=this.el.keywordWrap.offsetWidth+6+"px",this.el.input.value=this.buildRealStringFromKeywords(),this.restrict&&this.updateAlreadyChosenChoicesFromKeywords()},r.prototype.highlightKeyword=function(e){t(e,this.colors.highlight),this.el.fake.blur(),e.firstElementChild.focus(),this.el.highlightedKeyword=e},r.prototype.unhighlightKeyword=function(e){t(e,this.colors.default),this.el.highlightedKeyword=null},r.prototype.buildRealStringFromKeywords=function(){for(var e="",t=this.el.keywordWrap.children,i=0,o=t.length;i<o;i++)e+=t[i].textContent+this.delimiter;return e},r.prototype.updateKeywordsFromRealString=function(e){if(this.el.keywordWrap.innerHTML="",e.trim())for(var t=e.trim().split(this.delimiter),i=0,o=t.length;i<o;i++)this.addKeyword({keyword:t[i],match:"exact"})},r.prototype.updateAlreadyChosenChoicesFromKeywords=function(){for(var e=this.el.choicesWrap.children,t=1,i=e.length;t<i;t++)this.el.input.value.indexOf(e[t].textContent)>-1?e[t].classList.add("kwjs-alreadychosen"):e[t].classList.remove("kwjs-alreadychosen")},r.prototype.updateFilteredChoicesFromInput=function(e){if(this.restrict){for(var t,i,o=!1,r=1,l=(t=this.el.choicesWrap.querySelectorAll(":not(.kwjs-alreadychosen)")).length;r<l;r++)i=t[r].textContent.toLowerCase(),e=e.toLowerCase(),0===i.indexOf(e)?(t[r].classList.remove("kwjs-filteredout"),o=!0):t[r].classList.add("kwjs-filteredout");this.el.highlightedChoice&&(this.el.highlightedChoice.classList.remove("kwjs-highlighted"),this.el.highlightedChoice=null),o?this.el.unallowed.classList.add("kwjs-filteredout"):this.el.unallowed.classList.remove("kwjs-filteredout")}},r.prototype.autoCompleteKeyword=function(e){if(!this.restrict)return!0;var t,o;return(t=this.el.choicesWrap.querySelectorAll(":not(:first-child):not(.kwjs-alreadychosen):not(.kwjs-filteredout)")).length>0?(o=this.el.highlightedChoice?i(t,this.el.highlightedChoice):0,t[o].textContent):""},r.prototype.highlightChoice=function(e){this.el.highlightedChoice&&this.el.highlightedChoice.classList.remove("kwjs-highlighted"),e&&e.classList.add("kwjs-highlighted"),this.el.highlightedChoice=e},r}()}(window);