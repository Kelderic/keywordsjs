!function(e){e.Keywords=function(){function t(e,t){for(var i in t)t.hasOwnProperty(i)&&(e.style[i]=t[i])}function i(e,t){for(var i=0,r=e.length;i<r;i++)if(t==e[i])return i;return-1}function r(e){if("kwjs-keyword"==e.className)return e;for(;"kwjs-keyword"!=e.className&&"body"!=e.nodeName.toLowerCase();)e=e.parentNode;return"body"!=e.tagName.toLowerCase()&&e}var l=function(l){var o=this;if(!("selector"in l))return!1;o.dragging=!1;var n=document.querySelector("style#kwjs-css");n?o.css=n:(o.css=document.createElement("style"),o.css.type="text/css",o.css.id="kwjs-css",o.css.innerHTML+=".kwjs-outerwrap { position: relative; } ",o.css.innerHTML+=".kwjs-keywordwrap { pointer-events: none; position: absolute; z-index:1; padding: 4px 0 4px 4px; } ",o.css.innerHTML+=".kwjs-keyword { display: inline-block; font-size: inherit; font-weight: inherit; font-style: inherit; font-family: inherit; vertical-align:bottom; pointer-events: auto; position: relative; border-radius: 2px; box-sizing: border-box; margin-right: 4px; cursor: move } ",o.css.innerHTML+=".kwjs-choiceswrap { position: absolute; top: calc(100% + 2px); left: 0; right: 0; z-index:2; max-height:300px; overflow:auto; list-style: none; margin:0; padding:0; transform: scaleY(0); transform-origin:top; transition:transform 0.2s } ",o.css.innerHTML+=".kwjs-choiceswrap li { cursor:pointer; padding:5px } ",o.css.innerHTML+=".kwjs-choiceswrap li:hover, li.kwjs-highlighted { background:white; } ",o.css.innerHTML+="li.kwjs-alreadychosen, li.kwjs-filteredout { display:none; } ",o.css.innerHTML+=".kwjs-focused .kwjs-choiceswrap { transform:none; } ",document.body.appendChild(o.css)),o.el={},o.el.input=document.querySelector(l.selector),o.el.fake=o.el.input.cloneNode(),o.el.fake.name="",o.el.fake.id="",o.el.fake.value="";var a=e.getComputedStyle(o.el.input,null),h=a.getPropertyValue("display");o.el.input.type="hidden",o.colors={},"colors"in l&&(o.colors.default="default"in l.colors?l.colors.default:{},o.colors.highlight="highlight"in l.colors?l.colors.highlight:{},"color"in o.colors.default&&(o.colors.default.fill=o.colors.default.color),"color"in o.colors.highlight&&(o.colors.highlight.fill=o.colors.highlight.color)),"delimiter"in l?o.delimiter=l.delimiter:null!==o.el.input.getAttribute("kwjs-delimiter")?o.delimiter=o.el.input.getAttribute("kwjs-delimiter"):o.delimiter=" ";var d="";if("choices"in l)var s=l.choices;else if(null!==o.el.input.getAttribute("kwjs-choices"))s=o.el.input.getAttribute("kwjs-choices").split(o.delimiter);else s=[];if(s.length>0){d='<li class="kwjs-filteredout" style="color:gray;font-style:italic;pointer-events:none">Unallowed</li>';for(var c=0,g=s.length;c<g;c++)d+="<li>"+s[c]+"</li>";o.restrict=!0}else o.restrict=!1;o.el.outerWrap=document.createElement("div"),o.el.keywordWrap=document.createElement("div"),o.el.template=document.createElement("div"),o.el.template.draggable=!0,o.el.dropzone=document.createElement("div"),o.el.choicesWrap=document.createElement("ul"),o.el.choicesWrap.innerHTML=d,o.el.choicesWrap.tabIndex=-1,o.el.unallowed=o.el.choicesWrap.firstElementChild,o.el.highlightedKeyword=null,o.el.highlightedChoice=null,o.el.beingDragged=null,o.el.outerWrap.className="kwjs-outerwrap",o.el.keywordWrap.className="kwjs-keywordwrap",o.el.template.className="kwjs-keyword",o.el.choicesWrap.className="kwjs-choiceswrap",o.el.dropzone.className="kwjs-keyword kwjs-dropzone",t(o.el.outerWrap,{display:"inline"==h?"inline-block":h,width:a.getPropertyValue("width"),"min-width":a.getPropertyValue("min-width"),"max-width":a.getPropertyValue("max-width")}),t(o.el.keywordWrap,{top:a.getPropertyValue("border-top-width"),left:a.getPropertyValue("border-left-width")}),t(o.el.template,{"padding-left":parseInt(a.getPropertyValue("padding-left"))-2+"px","padding-right":parseInt(a.getPropertyValue("padding-right"))-2+20+"px","line-height":parseInt(a.getPropertyValue("height"))-8+"px",height:parseInt(a.getPropertyValue("height"))-8+"px"}),t(o.el.choicesWrap,{background:a.getPropertyValue("background"),"background-color":a.getPropertyValue("background-color"),"box-shadow":a.getPropertyValue("box-shadow")}),t(o.el.template,o.colors.default),t(o.el.dropzone,{"padding-left":"2px","padding-right":"2px",height:parseInt(a.getPropertyValue("height"))-8+"px",background:"rgb(30,130,230)",margin:"0 0 0 -4px"}),t(o.el.dropzone,o.colors.highlight),o.el.input.parentNode.insertBefore(o.el.outerWrap,o.el.input.nextSibling),o.el.outerWrap.appendChild(o.el.input),o.el.outerWrap.appendChild(o.el.fake),o.el.outerWrap.appendChild(o.el.keywordWrap),s.length>0&&o.el.outerWrap.appendChild(o.el.choicesWrap),o.updateKeywordsFromRealString(o.el.input.value),o.el.choicesWrap.addEventListener("mousedown",function(t){0===t.button?("li"==t.target.nodeName.toLowerCase()&&o.addKeyword({keyword:t.target.textContent,match:"exact"}),e.setTimeout(function(e){o.el.fake.focus()},10)):t.preventDefault()}),o.el.outerWrap.addEventListener("focusin",function(e){o.el.outerWrap.classList.add("kwjs-focused"),o.el.highlightedKeyword&&o.unhighlightKeyword(o.el.highlightedKeyword)}),o.el.outerWrap.addEventListener("focusout",function(t){e.setTimeout(function(e){o.el.outerWrap.contains(document.activeElement)||o.el.outerWrap.classList.remove("kwjs-focused")},20),o.el.fake.value&&e.setTimeout(function(e){o.addKeyword({keyword:o.el.fake.value,match:"begins-with"})},10)}),o.el.outerWrap.addEventListener("keypress",function(t){1!==t.key.length||t.ctrlKey||(t.key==o.delimiter?(t.preventDefault(),o.el.fake.value?e.setTimeout(function(e){o.addKeyword({keyword:o.el.fake.value,match:"begins-with"})},10):o.el.highlightedChoice&&(t.preventDefault(),o.addKeyword({keyword:o.el.highlightedChoice.textContent,match:"exact"}))):o.updateFilteredChoicesFromInput(o.el.fake.value+t.key))}),o.el.outerWrap.addEventListener("keydown",function(t){var r=null;if(13==t.which)o.el.fake.value&&(t.preventDefault(),e.setTimeout(function(e){o.addKeyword({keyword:o.el.fake.value,match:"begins-with"})},10)),o.el.highlightedChoice&&(t.preventDefault(),o.addKeyword({keyword:o.el.highlightedChoice.textContent,match:"exact"}));else if(8==t.which)!o.el.fake.value&&o.el.keywordWrap.children.length>0?(t.preventDefault(),o.el.highlightedKeyword?((r=o.el.highlightedKeyword).previousElementSibling?o.highlightKeyword(r.previousElementSibling):o.el.fake.focus(),o.removeKeyword(r)):o.highlightKeyword(o.el.keywordWrap.lastChild)):e.setTimeout(function(e){o.updateFilteredChoicesFromInput(o.el.fake.value)},10);else if(46==t.which)!o.el.fake.value&&o.el.keywordWrap.children.length>0?o.el.highlightedKeyword&&((r=o.el.highlightedKeyword).nextElementSibling?o.highlightKeyword(r.nextElementSibling):o.el.fake.focus(),o.removeKeyword(r)):e.setTimeout(function(e){o.updateFilteredChoicesFromInput(o.el.fake.value)},10);else if(37==t.which)!o.el.fake.value&&o.el.keywordWrap.children.length>0&&(o.el.highlightedKeyword?(r=o.el.highlightedKeyword).previousElementSibling&&(o.unhighlightKeyword(r),o.highlightKeyword(r.previousElementSibling)):o.highlightKeyword(o.el.keywordWrap.lastChild));else if(39==t.which)!o.el.fake.value&&o.el.keywordWrap.children.length>0&&o.el.highlightedKeyword&&(r=o.el.highlightedKeyword,o.unhighlightKeyword(r),r.nextElementSibling?o.highlightKeyword(r.nextElementSibling):o.el.fake.focus());else if(38==t.which||40==t.which){t.preventDefault();var l,n=o.el.choicesWrap.querySelectorAll(":not(.kwjs-alreadychosen):not(.kwjs-filteredout)");o.el.highlightedKeyword||(o.el.highlightedChoice?(l=i(n,o.el.highlightedChoice),(l=38==t.which?l-1:l+1)<0?o.highlightChoice(null):l<n.length&&o.highlightChoice(n[l])):o.highlightChoice(38==t.which?null:n[0]))}}),o.el.outerWrap.addEventListener("paste",function(t){e.setTimeout(function(e){o.updateFilteredChoicesFromInput(o.el.fake.value)},10)}),o.el.keywordWrap.addEventListener("click",function(e){"button"==e.target.nodeName.toLowerCase()&&(o.removeKeyword(e.target.parentNode),o.el.fake.focus())}),o.el.keywordWrap.addEventListener("dragstart",function(e){var t=r(e.target);t&&(e.dataTransfer.setData("text/html",t),o.el.beingDragged=t,o.dragging=!0,o.el.highlightedKeyword&&o.unhighlightKeyword(o.el.highlightedKeyword))}),document.addEventListener("dragover",function(e){if(e.preventDefault(),o.dragging){var t=r(e.target);if(t&&!t.classList.contains("kwjs-dropzone")){var i=t.getBoundingClientRect(),l=i.x+i.width/2;e.clientX-l>0?o.el.keywordWrap.insertBefore(o.el.dropzone,t.nextElementSibling):o.el.keywordWrap.insertBefore(o.el.dropzone,t)}}}),document.addEventListener("drop",function(e){e.preventDefault(),o.dragging&&(o.dragging=!1,o.el.keywordWrap.insertBefore(o.el.beingDragged,o.el.dropzone),o.el.keywordWrap.removeChild(o.el.dropzone),o.el.input.value=o.buildRealStringFromKeywords())}),document.addEventListener("dragover",function(e){o.dragging&&e.preventDefault()})};return l.prototype.addKeyword=function(e){var t=this,i="keyword"in e?e.keyword:"",r="match"in e?e.match:"exact";if(""!==i)if(t.restrict&&"begins-with"==r&&(i=t.autoCompleteKeyword(i)),""===i)t.el.fake.value="",t.updateFilteredChoicesFromInput(t.el.fake.value);else{var l=t.el.template.cloneNode();l.innerHTML=i+'<button type="button" tabindex="-1" style="appearance:none; fill:inherit; color:inherit; font-size:0; background:transparent; border:none; box-shadow:none; cursor:pointer; position:absolute; top:calc(50% - 10px); right:2px; padding:4px; height:auto; width:auto;"><svg style="pointer-events:none;height:14px;width:14px;" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 16 16"><polygon points="15,3 13,1 8,6 3,1 1,3 6,8 1,13 3,15 8,10 13,15 15,13 10,8 "/></svg></button>',t.el.keywordWrap.appendChild(l),t.el.fake.style["padding-left"]=t.el.keywordWrap.offsetWidth+6+"px",t.el.input.value=t.buildRealStringFromKeywords(),t.el.fake.value="",t.restrict&&(t.updateAlreadyChosenChoicesFromKeywords(),t.updateFilteredChoicesFromInput(t.el.fake.value))}},l.prototype.removeKeyword=function(e){this.el.keywordWrap.removeChild(e),this.el.fake.style["padding-left"]=this.el.keywordWrap.offsetWidth+6+"px",this.el.input.value=this.buildRealStringFromKeywords(),this.restrict&&this.updateAlreadyChosenChoicesFromKeywords()},l.prototype.highlightKeyword=function(e){t(e,this.colors.highlight),this.el.fake.blur(),e.firstElementChild.focus(),this.el.highlightedKeyword=e},l.prototype.unhighlightKeyword=function(e){t(e,this.colors.default),this.el.highlightedKeyword=null},l.prototype.buildRealStringFromKeywords=function(){for(var e="",t=this.el.keywordWrap.children,i=0,r=t.length;i<r;i++)e+=t[i].textContent+this.delimiter;return e},l.prototype.updateKeywordsFromRealString=function(e){if(this.el.keywordWrap.innerHTML="",e.trim())for(var t=e.trim().split(this.delimiter),i=0,r=t.length;i<r;i++)this.addKeyword({keyword:t[i],match:"exact"})},l.prototype.updateAlreadyChosenChoicesFromKeywords=function(){for(var e=this.el.choicesWrap.children,t=1,i=e.length;t<i;t++)this.el.input.value.indexOf(e[t].textContent)>-1?e[t].classList.add("kwjs-alreadychosen"):e[t].classList.remove("kwjs-alreadychosen")},l.prototype.updateFilteredChoicesFromInput=function(e){if(this.restrict){for(var t,i,r=!1,l=1,o=(t=this.el.choicesWrap.querySelectorAll(":not(.kwjs-alreadychosen)")).length;l<o;l++)i=t[l].textContent.toLowerCase(),e=e.toLowerCase(),0===i.indexOf(e)?(t[l].classList.remove("kwjs-filteredout"),r=!0):t[l].classList.add("kwjs-filteredout");this.el.highlightedChoice&&(this.el.highlightedChoice.classList.remove("kwjs-highlighted"),this.el.highlightedChoice=null),r?this.el.unallowed.classList.add("kwjs-filteredout"):this.el.unallowed.classList.remove("kwjs-filteredout")}},l.prototype.autoCompleteKeyword=function(e){if(!this.restrict)return!0;var t,r;return(t=this.el.choicesWrap.querySelectorAll(":not(:first-child):not(.kwjs-alreadychosen):not(.kwjs-filteredout)")).length>0?(r=this.el.highlightedChoice?i(t,this.el.highlightedChoice):0,t[r].textContent):""},l.prototype.highlightChoice=function(e){this.el.highlightedChoice&&this.el.highlightedChoice.classList.remove("kwjs-highlighted"),e&&e.classList.add("kwjs-highlighted"),this.el.highlightedChoice=e},l}()}(window);